<div class="row">

<div class="chart-type-selector chart-series-type">
  @if(!isLive){
    {{sensorName}}
  }

  @if(isLive){
    <app-data-source-options
      [dataSourceType]="dataSourceType"
      [selectedDays]="selectedDays"
      [daysOptions]="daysOptions"
      (dataSourceTypeChange)="changeDataSourceType($event)"
      (selectedDaysChange)="changeSelectedDays($event)">
    </app-data-source-options>
  }

</div>

<div class="chart-type-selector">


  @for (key of availableKeys; track key) {
  <button
    class="button"
    [class.active]="keyToDisplay === key"
    (click)="selectDataKey(key)">
    <i class="icon-bar"></i> {{getKeyName(key)}}
  </button>
  }

  @if(temperature.length) {
    {{temperature[0].sensorId}}
  }
</div>

</div>
<div style="display: block;">
  <canvas baseChart
          [data]="chartData"
          [options]="chartOptions"
          [type]="chartType"
          (dblclick)="onChartDoubleClick($event)"
          (chartClick)="onChartClick($event)"
          (mousedown)="onMouseDown($event)"
          (mousemove)="onMouseMove($event)"
          (mouseup)="onMouseUp($event)"
          (mouseleave)="onMouseLeave($event)"
  >
  </canvas>

  @if(!temperature.length) {
  <!-- Break chips container -->
  @if(isLive && detectedBreaks.length > 0) {
    <div class="breaks-container">
      <div class="breaks-label">Wykryte przerwy: <small>(Kliknij by utworzyc adnotacje)</small></div>
      <div class="breaks-chips">
        @for(breakItem of detectedBreaks; track breakItem.start) {
          <div
            class="break-chip"
            (mouseenter)="highlightBreakAnnotation(breakItem)"
            (mouseleave)="unhighlightBreakAnnotation()"
            (click)="createAnnotationFromBreak(breakItem)"
          >
            Przerwa ({{breakItem.start | date: 'HH:mm'}} + {{ Math.round(breakItem.duration)}} min)
          </div>
        }
      </div>
    </div>
  }

  <ion-row class="flex ion-justify-content-end ion-align-items-center">
    <button
      class="button active ion-margin-end"
      [class.success]="isAnnotationVisible"
      (click)="toggleAnnotations()">
      @if(isAnnotationVisible) {
        Ukryj
      }@else {
        Pokaż
      }
      adnotacje
    </button>

    @if(newAnnotation) {
        <span class="ion-margin-end">
          {{newAnnotation.from_timestamp.length === 0 ? 'Wybierz początek adnotacji' : 'Wybierz koniec adnotacji'}}
        </span>
    }

    @if(!newAnnotation) {
<!--      <button-->
<!--        class="button active"-->
<!--        (click)="presentAnnotationOptions()">-->
<!--        Dodaj Adnotacje-->
<!--      </button>-->

    } @else {
      <button
        class="button active warning"
        (click)="newAnnotation = null">
        Anuluj
      </button>
    }
<!--    </ion-row >-->

    <button
      class="button active"
      (click)="openChartOperationsList($event)">
      Operacje
    </button>


  </ion-row >
  }
</div>
